# /etc/chrony/chrony.conf - Optimized GPS Chrony Server Configuration
# Based on professional NTP server configuration for public time serving

# Essential files
driftfile /var/lib/chrony/drift

# Logging
logdir /var/log/chrony
log statistics measurements tracking

# Security - Enable command port for local access
cmdport 127.0.0.1
cmdallow 127.0.0.1
cmdallow ::1
cmddeny 0.0.0.0/0
cmddeny ::/0

# GPS References - Optimized polling
# GPS References - Using SHM 2 for GPS data (confirmed via ntpshmmon)
refclock SHM 2 offset 0.0 delay 0.1 refid GPS

# Upstream servers - Reliable fallback servers
# Primary GPS-based servers (if GPS is working)
server ntp.se iburst minpoll 6 maxpoll 10

# Reliable fallback NTP servers
server pool.ntp.org iburst minpoll 6 maxpoll 10


# Access Control - Allow all networks (public time server)
allow 0.0.0.0/0
allow ::/0

# Performance tuning
maxupdateskew 100.0
maxdrift 500.0
maxchange 1000 1 2
maxchange 2000 1 2
maxchange 4000 1 2
maxchange 8000 1 2

# ARM/Raspberry Pi optimizations
maxupdateskew 50.0

# GPS-specific optimizations
minsamples 1
maxsamples 3

# Local stratum for time serving
local stratum 10
